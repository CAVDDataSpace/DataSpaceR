---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

# DataSpaceR <img src="man/figures/logo.png" align="right" />

[![Build Status](https://travis-ci.org/CAVDDataSpace/DataSpaceR.svg?branch=master)](https://travis-ci.org/CAVDDataSpace/DataSpaceR)
[![Build status](https://ci.appveyor.com/api/projects/status/bmwyv5i32xr07bdr/branch/master?svg=true)](https://ci.appveyor.com/project/juyeongkim/dataspacer/branch/master)
[![codecov](https://codecov.io/gh/CAVDDataSpace/DataSpaceR/branch/master/graph/badge.svg)](https://codecov.io/gh/CAVDDataSpace/DataSpaceR/branch/master)

## Overview

A thin wrapper around [Rlabkey](https://cran.r-project.org/web/packages/Rlabkey/index.html) to access the [CAVD DataSpace](https://dataspace.cavd.org)
database from R. This package simplifies access to the database for R programmers.

It takes advantage of the standardization of the database to hide all 
the [Rlabkey](https://cran.r-project.org/web/packages/Rlabkey/index.html) 
specific code away from the user. Study-specific datasets can be accessed via 
an object-oriented paradigm.


## Installation

The package can be downloaded here and installed like any other R packages or 
installed directly from github using [devtools](https://cran.r-project.org/web/packages/devtools/index.html) or [drat](https://cran.r-project.org/web/packages/drat/index.html).


### using `devtools` (development):

https://github.com/CAVDDataSpace/DataSpaceR

```{r, eval=FALSE}
# install.packages("devtools")
devtools::install_github("CAVDDataSpace/DataSpaceR")
```


### using `drat` (stable):

https://github.com/CAVDDataSpace/drat

```{r, eval=FALSE}
# install.packages("drat")
drat::addRepo("CAVDDataSpace")
install.packages("DataSpaceR")
```


## Set netrc file

The database is accessed with the user's credentials. A `netrc` file storing 
login and password information is required.

Create netrc file in the computer running R.

* On a UNIX system this file should be named `.netrc` (**dot**`netrc`) 
* On windows it sould be named `_netrc` (**underscore**`netrc`). 
* The file should be located in the users home directory and the permissions
on the file should be unreadable for everybody except the owner. To determine
home directory, run `Sys.getenv("HOME")` in R.

The following three lines must be included in the `.netrc` or `_netrc` file 
either separated by white space (spaces, tabs, or newlines) or commas.

```
machine dataspace.cavd.org
login myuser@domain.com
password supersecretpassword
```

Multiple such blocks can exist in one file.

See [here](https://www.labkey.org/wiki/home/Documentation/page.view?name=netrc) 
for more information about `netrc`.


## Usage

The general idea is that the user:

1. creates an instance of `DataSpaceConnection` class via `connectDS`
2. browses available studies and groups in the instance via `availableStudies` and `availableGroups`
3. creates a connection to a specific study via `getStudy` or a group via `getGroup`
4. retrieves datasets by name via `getDataset`


### for example:

```{r}
library(DataSpaceR)

con <- connectDS()
con
```

`connectDS()` will create a connection to DataSpace. The user needs 
credentials stored in a `netrc` file to access the database. 


### available studies can be listed by:

```{r}
knitr::kable(head(con$availableStudies))
```


### available groups can be listed by:

```{r}
knitr::kable(con$availableGroups)
```


### `con$getStudy("cvd408")` will create an instance of `cvd408`.

```{r}
cvd408 <- con$getStudy("cvd408")
cvd408
class(cvd408)
```


### available datasets can be listed by:

```{r}
knitr::kable(cvd408$availableDatasets)
```

which will print names of available datasets.


### neutralizing antibody dataset (`NAb`) can be retreived by:

```{r}
NAb <- cvd408$getDataset("NAb")
dim(NAb)
colnames(NAb)
```

The package uses a [R6](https://cran.r-project.org/web/packages/R6/index.html) 
class to represent the connection to a study and get around some of R's 
copy-on-change behaviour.
